#!/bin/bash

clear
# Warna untuk output (sesuaikan dengan kebutuhan)
NC='\e[0m'       # No Color (mengatur ulang warna teks ke default)
DEFBOLD='\e[39;1m' # Default Bold
RB='\e[31;1m'    # Red Bold
GB='\e[32;1m'    # Green Bold
YB='\e[33;1m'    # Yellow Bold
BB='\e[34;1m'    # Blue Bold
MB='\e[35;1m'    # Magenta Bold
CB='\e[36;1m'    # Cyan Bold
WB='\e[37;1m'    # White Bold

config_file="/usr/local/etc/xray/config/04_inbounds.json"

vmess_count=$(awk '/###/ {count++} END {print count+0}' "$config_file" 2>/dev/null)
vless_count=$(awk '/##!/ {count++} END {print count+0}' "$config_file" 2>/dev/null)
trojan_count=$(awk '/#&!/ {count++} END {print count+0}' "$config_file" 2>/dev/null)
ss_count=$(awk '/##@/ {count++} END {print count+0}' "$config_file" 2>/dev/null)

vmess=$(( vmess_count / 3 ))
vless=$(( vless_count / 4 ))
trojan=$(( trojan_count / 6 ))
ss=$(( ss_count / 6 ))

# Fungsi untuk memeriksa status layanan
check_service() {
    local service_name=$1
    if systemctl is-active --quiet "$service_name"; then
        echo "${GB}Good${NC}"
    else
        echo "${RB}Eror${NC}"
    fi
}

clear
LAYOUT="
  ${BB}————————————————————————————————${NC}
            ${CB}SAN TUNNELING${NC}
  ${BB}————————————————————————————————${NC}
  Xray Service : $(check_service xray.service)
  Wireproxy    : $(check_service wireproxy.service)
  Nginx        : $(check_service nginx)
  ${BB}————————————————————————————————${NC}
       ${GB}Vmess Account   : ${YB} $vmess${NC}
       ${GB}Vless Account   : ${YB} $vless${NC}
       ${GB}Trojan Account  : ${YB} $trojan${NC}
       ${GB}Sodosok Account : ${RB} $ss${NC}
  ${BB}————————————————————————————————${NC}
    1. ${CB}Vmess Menu${NC}    4. ${CB}SS Menu${NC}
    2. ${CB}Vless Menu${NC}    5. ${CB}Bot Menu${NC}
    3. ${CB}Trojan Menu${NC}   6. ${CB}Other Menu${NC}
  ${BB}————————————————————————————————${NC}
       ${MB}Autoscript Mod By San${NC}
  ${BB}————————————————————————————————${NC}
"
echo -e "$LAYOUT"    
read -p " Select Menu :  " opt
case $opt in
    1) clear ; vmessmenu ;;
    2) clear ; vlessmenu ;;
    3) clear ; trojanmenu ;;
    4) clear ; sodosokmenu ;;
    5) clear ; echo -e "Comming Soon" ;;
    6) clear ; settingmenu ;;
    *) echo -e "${YB}Invalid input${NC}" ; sleep 1 ; menu ;;
esac
